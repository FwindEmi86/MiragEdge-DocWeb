# SkyElytra（幻空翼飞行系统）插件文档
### 核心定位
为Paper1.21.11服务端打造的**精细化飞行管理插件**，针对**建筑玩家**实现领地内平衡可控的无限飞行体验，为**冒险玩家**提供幻空翼、经验双模式限时飞行功能，粒子特效。

### 插件基础信息
| 项⽬         | 详情                                                                 |
|--------------|----------------------------------------------------------------------|
| 主命令     | `/skyelytra`（别名：`/fly`、`/se`，支持指令自动补全） |
| 作者     | F.windEmiko（狐风轩汐）|
| 服务端兼容   | Paper 1.21.8+（Spigot兼容）|
| 开发环境     | Java 21                                                              |
| 数据库   | SQLite（支持MySQL）|
| 挂钩插件（均为软依赖，模块设计） | LuckPerms、PlaceholderAPI、WorldGuard、dominion |


## 一、快速上手
### 1.1 基础配置
插件配置目录包含`config.yml`等多模块配置文件，合理设计、`messages.yml`（消息自定义）、`data/`（数据库文件）、`data/cache`（缓存文件[如果有]）；

### 1.2 核心子命令操作
- 查看自身或他人的飞行信息：`info <player>`；权限：默认可查看自己，op或权限可查看他人`skyelytra.admin.info`
- 切换限时飞行模式(幻空翼/经验值/关闭)：`toggle skyelytra/exp/none`；权限（默认）：`skyelytra.toggle.*`
- 设置无限飞行（无限时间和不消耗经验值）：`infinite skyelytra/exp <player>`；权限(op)：`skyelytra.admin.infinite`
- 切换剩余时间显示方式（BOSS栏和活动栏）：`show actionbar/bossbar`；权限（默认）：`skyelytra.show.*`
- 管理员重载配置：`reload`；权限(op)：`skyelytra.admin.reload`
- 管理员修改玩家飞行时间（玩家支持补全）：`time add/remove/set <玩家名> <秒数>`；权限(op)：`skyelytra.admin.time`

## 二、核心功能详解
### 2.1 领地专属飞行体系
挂钩**dominion领地插件**：
1. 玩家仅在**自身领地**或**被添加为信任成员的他人领地**内，可无限飞行；
2. 领地边界机制：离开领地范围时，**未开启限时飞行功能**则立即触发坠落，**已开启幻空翼/经验飞行**则自动切换为对应限时飞行模式（就是在领地内不会扣时间或经验值）；
3. 领地飞行范围不受禁飞区限制

### 2.2 双模式限时飞行
#### 2.2.1 幻空翼限时飞行
- 飞行时长存在最大飞行时间限制，不同权限组可单独设置上限；
- 新玩家初始飞行时长支持自定义配置；
- 管理员可通过`time`子指令修改玩家剩余时长；
- 时长消耗仅在**实际飞行状态**下触发，落地/取消飞行则停止计时；
- **粒子特效**：飞行时玩家脚底生成粒子特效，粒子效果种类支持配置，默认为绿色小粒子，支持不同权限组（会员）设置不同粒子；

#### 2.2.2 经验飞行
- 消耗玩家经验值的动态飞行模式，每秒消耗经验值数量支持自定义配置，不同权限组支持单独配置；
- 经验不足时自动取消飞行并触发坠落；
- 与幻空翼飞行模式无法同时开启，通过`toggle exp`无缝切换。

### 2.5 可视化显示控制
飞行剩余时长支持**双模式显示**，，显示内容可在消息配置中可自定义：
1. 动作栏（Actionbar）；
2. 老板栏（Bossbar）；
3. 格式自定义：支持`%时%分%秒`等占位符，可配置；

### 2.6 飞行状态保存
1. 保存内容：包含当前飞行模式（幻空翼/经验）、剩余时间显示载体（动作栏/老板栏）、无限飞行状态（开启/关闭）、飞行功能开关状态（飞行中/未飞行）；
2. 当玩家正常退出服务器、服务器重启/重载、手动切换飞行状态时记录；
3. 当玩家重新登录服务器等，重新开启飞行功能，避免频繁开关操作；
4. 该功能可配置是否开启，默认开启。

### 2.7 摔落伤害与坠落条件
保障服务器战斗公平性，所有规则可配置
#### 2.7.1 战斗坠落机制
飞行中战斗行为触发强制坠落：
1. 玩家在飞行状态下**主动攻击任意实体**或**受到任意实体攻击**，立即触发坠落；
2. 一段时间后（默认10秒）自动恢复飞行状态，可配置；

#### 2.7.2 重锤坠落机制
支持配置重锤是否在拿起重锤时无法飞行和立即坠落，以及在坠落图中是否可以造成伤害；

#### 2.7.3 飞行高度限制
可在配置中自定义飞行高度上下限，支持不同权限组独立配置

#### 2.7.4 禁飞区域
挂钩WorldGuard插件
1. 当玩家进入配置的禁飞区域（WorldGuard插件中定义的区域名），立即触发坠落；
2. 领地飞行无视禁飞区域；

#### 2.7.5 摔落伤害
1. 启用了飞行功能，但没有进入飞行状态时，从高处跳下会正常收到摔落伤害，可配置
2. 可配置战斗行为坠落是否造成伤害
3. 进入禁飞区域坠落是否造成摔落伤害

调试模式：支持开启debug模式输出详细运行日志

占位符格式：可自定义PlaceholderAPI（PAPI）占位符的时间显示格式（如%时%分%秒），是否在飞行状态，可在消息配置中自定义

独立的messages.yml配置文件，全消息文本支持颜色格式化码，兼容原版游戏的&和minimassage格式
默认消息采用「简约美观的渐变配色 + 白话文风格」，可全量自定义

完善的权限系统

使用模块化思维开发，分类